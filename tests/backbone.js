(function(){var n=this;var l=n.Backbone;var m=Array.prototype.slice;var u=Array.prototype.splice;var b;if(typeof exports!=="undefined"){b=exports}else{b=n.Backbone={}}b.VERSION="0.9.1";var v=n._;if(!v&&(typeof require!=="undefined")){v=require("underscore")}var e=n.jQuery||n.Zepto||n.ender;b.setDomLibrary=function(w){e=w};b.noConflict=function(){n.Backbone=l;return this};b.emulateHTTP=false;b.emulateJSON=false;b.Events={on:function(z,C,y){var A;z=z.split(/\s+/);var x=this._callbacks||(this._callbacks={});while(A=z.shift()){var B=x[A]||(x[A]={});var w=B.tail||(B.tail=B.next={});w.callback=C;w.context=y;B.tail=w.next={}}return this},off:function(y,B,x){var A,w,z;if(!y){delete this._callbacks}else{if(w=this._callbacks){y=y.split(/\s+/);while(A=y.shift()){z=w[A];delete w[A];if(!B||!z){continue}while((z=z.next)&&z.next){if(z.callback===B&&(!x||z.context===x)){continue}this.on(A,z.callback,z.context)}}}}return this},trigger:function(z){var D,C,y,x,w,B,A;if(!(y=this._callbacks)){return this}B=y.all;(z=z.split(/\s+/)).push(null);while(D=z.shift()){if(B){z.push({next:B.next,tail:B.tail,event:D})}if(!(C=y[D])){continue}z.push({next:C.next,tail:C.tail})}A=m.call(arguments,1);while(C=z.pop()){x=C.tail;w=C.event?[C.event].concat(A):A;while((C=C.next)!==x){C.callback.apply(C.context||this,w)}}return this}};b.Events.bind=b.Events.on;b.Events.unbind=b.Events.off;b.Model=function(w,x){var y;w||(w={});if(x&&x.parse){w=this.parse(w)}if(y=c(this,"defaults")){w=v.extend({},y,w)}if(x&&x.collection){this.collection=x.collection}this.attributes={};this._escapedAttributes={};this.cid=v.uniqueId("c");if(!this.set(w,{silent:true})){throw new Error("Can't create an invalid model")}delete this._changed;this._previousAttributes=v.clone(this.attributes);this.initialize.apply(this,arguments)};v.extend(b.Model.prototype,b.Events,{idAttribute:"id",initialize:function(){},toJSON:function(){return v.clone(this.attributes)},get:function(w){return this.attributes[w]},escape:function(w){var x;if(x=this._escapedAttributes[w]){return x}var y=this.attributes[w];return this._escapedAttributes[w]=v.escape(y==null?"":""+y)},has:function(w){return this.attributes[w]!=null},set:function(D,C,F){var E,B,y;if(v.isObject(D)||D==null){E=D;F=C}else{E={};E[D]=C}F||(F={});if(!E){return this}if(E instanceof b.Model){E=E.attributes}if(F.unset){for(B in E){E[B]=void 0}}if(!this._validate(E,F)){return false}if(this.idAttribute in E){this.id=E[this.idAttribute]}var x=this.attributes;var w=this._escapedAttributes;var z=this._previousAttributes||{};var A=this._setting;this._changed||(this._changed={});this._setting=true;for(B in E){y=E[B];if(!v.isEqual(x[B],y)){delete w[B]}F.unset?delete x[B]:x[B]=y;if(this._changing&&!v.isEqual(this._changed[B],y)){this.trigger("change:"+B,this,y,F);this._moreChanges=true}delete this._changed[B];if(!v.isEqual(z[B],y)||(v.has(x,B)!=v.has(z,B))){this._changed[B]=y}}if(!A){if(!F.silent&&this.hasChanged()){this.change(F)}this._setting=false}return this},unset:function(w,x){(x||(x={})).unset=true;return this.set(w,null,x)},clear:function(w){(w||(w={})).unset=true;return this.set(v.clone(this.attributes),w)},fetch:function(x){x=x?v.clone(x):{};var w=this;var y=x.success;x.success=function(B,z,A){if(!w.set(w.parse(B,A),x)){return false}if(y){y(w,B)}};x.error=b.wrapError(x.error,w,x);return(this.sync||b.sync).call(this,"read",this,x)},save:function(B,A,F){var C,z;if(v.isObject(B)||B==null){C=B;F=A}else{C={};C[B]=A}F=F?v.clone(F):{};if(F.wait){z=v.clone(this.attributes)}var x=v.extend({},F,{silent:true});if(C&&!this.set(C,F.wait?x:F)){return false}var y=this;var D=F.success;F.success=function(J,G,I){var H=y.parse(J,I);if(F.wait){H=v.extend(C||{},H)}if(!y.set(H,F)){return false}if(D){D(y,J)}else{y.trigger("sync",y,J,F)}};F.error=b.wrapError(F.error,y,F);var w=this.isNew()?"create":"update";var E=(this.sync||b.sync).call(this,w,this,F);if(F.wait){this.set(z,x)}return E},destroy:function(x){x=x?v.clone(x):{};var w=this;var A=x.success;var z=function(){w.trigger("destroy",w,w.collection,x)};if(this.isNew()){return z()}x.success=function(B){if(x.wait){z()}if(A){A(w,B)}else{w.trigger("sync",w,B,x)}};x.error=b.wrapError(x.error,w,x);var y=(this.sync||b.sync).call(this,"delete",this,x);if(!x.wait){z()}return y},url:function(){var w=c(this.collection,"url")||c(this,"urlRoot")||p();if(this.isNew()){return w}return w+(w.charAt(w.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(x,w){return x},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(x){if(this._changing||!this.hasChanged()){return this}this._changing=true;this._moreChanges=true;for(var w in this._changed){this.trigger("change:"+w,this,this._changed[w],x)}while(this._moreChanges){this._moreChanges=false;this.trigger("change",this,x)}this._previousAttributes=v.clone(this.attributes);delete this._changed;this._changing=false;return this},hasChanged:function(w){if(!arguments.length){return !v.isEmpty(this._changed)}return this._changed&&v.has(this._changed,w)},changedAttributes:function(y){if(!y){return this.hasChanged()?v.clone(this._changed):false}var A,z=false,x=this._previousAttributes;for(var w in y){if(v.isEqual(x[w],(A=y[w]))){continue}(z||(z={}))[w]=A}return z},previous:function(w){if(!arguments.length||!this._previousAttributes){return null}return this._previousAttributes[w]},previousAttributes:function(){return v.clone(this._previousAttributes)},isValid:function(){return !this.validate(this.attributes)},_validate:function(y,x){if(x.silent||!this.validate){return true}y=v.extend({},this.attributes,y);var w=this.validate(y,x);if(!w){return true}if(x&&x.error){x.error(this,w,x)}else{this.trigger("error",this,w,x)}return false}});b.Collection=function(x,w){w||(w={});if(w.comparator){this.comparator=w.comparator}this._reset();this.initialize.apply(this,arguments);if(x){this.reset(x,{silent:true,parse:w.parse})}};v.extend(b.Collection.prototype,b.Events,{model:b.Model,initialize:function(){},toJSON:function(){return this.map(function(w){return w.toJSON()})},add:function(x,F){var B,D,z,C,E,y,A={},w={};F||(F={});x=v.isArray(x)?x.slice():[x];for(B=0,z=x.length;B<z;B++){if(!(C=x[B]=this._prepareModel(x[B],F))){throw new Error("Can't add an invalid model to a collection")}if(A[E=C.cid]||this._byCid[E]||(((y=C.id)!=null)&&(w[y]||this._byId[y]))){throw new Error("Can't add the same model to a collection twice")}A[E]=w[y]=C}for(B=0;B<z;B++){(C=x[B]).on("all",this._onModelEvent,this);this._byCid[C.cid]=C;if(C.id!=null){this._byId[C.id]=C}}this.length+=z;D=F.at!=null?F.at:this.models.length;u.apply(this.models,[D,0].concat(x));if(this.comparator){this.sort({silent:true})}if(F.silent){return this}for(B=0,z=this.models.length;B<z;B++){if(!A[(C=this.models[B]).cid]){continue}F.index=B;C.trigger("add",C,this,F)}return this},remove:function(B,z){var A,w,y,x;z||(z={});B=v.isArray(B)?B.slice():[B];for(A=0,w=B.length;A<w;A++){x=this.getByCid(B[A])||this.get(B[A]);if(!x){continue}delete this._byId[x.id];delete this._byCid[x.cid];y=this.indexOf(x);this.models.splice(y,1);this.length--;if(!z.silent){z.index=y;x.trigger("remove",x,this,z)}this._removeReference(x)}return this},get:function(w){if(w==null){return null}return this._byId[w.id!=null?w.id:w]},getByCid:function(w){return w&&this._byCid[w.cid||w]},at:function(w){return this.models[w]},sort:function(x){x||(x={});if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}var w=v.bind(this.comparator,this);if(this.comparator.length==1){this.models=this.sortBy(w)}else{this.models.sort(w)}if(!x.silent){this.trigger("reset",this,x)}return this},pluck:function(w){return v.map(this.models,function(x){return x.get(w)})},reset:function(z,x){z||(z=[]);x||(x={});for(var y=0,w=this.models.length;y<w;y++){this._removeReference(this.models[y])}this._reset();this.add(z,{silent:true,parse:x.parse});if(!x.silent){this.trigger("reset",this,x)}return this},fetch:function(w){w=w?v.clone(w):{};if(w.parse===undefined){w.parse=true}var y=this;var x=w.success;w.success=function(B,z,A){y[w.add?"add":"reset"](y.parse(B,A),w);if(x){x(y,B)}};w.error=b.wrapError(w.error,y,w);return(this.sync||b.sync).call(this,"read",this,w)},create:function(x,w){var y=this;w=w?v.clone(w):{};x=this._prepareModel(x,w);if(!x){return false}if(!w.wait){y.add(x,w)}var z=w.success;w.success=function(A,C,B){if(w.wait){y.add(A,w)}if(z){z(A,C)}else{A.trigger("sync",x,C,w)}};x.save(null,w);return x},parse:function(x,w){return x},chain:function(){return v(this.models).chain()},_reset:function(w){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(y,x){if(!(y instanceof b.Model)){var w=y;x.collection=this;y=new this.model(w,x);if(!y._validate(y.attributes,x)){y=false}}else{if(!y.collection){y.collection=this}}return y},_removeReference:function(w){if(this==w.collection){delete w.collection}w.off("all",this._onModelEvent,this)},_onModelEvent:function(y,x,z,w){if((y=="add"||y=="remove")&&z!=this){return}if(y=="destroy"){this.remove(x,w)}if(x&&y==="change:"+x.idAttribute){delete this._byId[x.previous(x.idAttribute)];this._byId[x.id]=x}this.trigger.apply(this,arguments)}});var s=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];v.each(s,function(w){b.Collection.prototype[w]=function(){return v[w].apply(v,[this.models].concat(v.toArray(arguments)))}});b.Router=function(w){w||(w={});if(w.routes){this.routes=w.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var g=/:\w+/g;var t=/\*\w+/g;var d=/[-[\]{}()+?.,\\^$|#\s]/g;v.extend(b.Router.prototype,b.Events,{initialize:function(){},route:function(w,x,y){b.history||(b.history=new b.History);if(!v.isRegExp(w)){w=this._routeToRegExp(w)}if(!y){y=this[x]}b.history.route(w,v.bind(function(A){var z=this._extractParameters(w,A);y&&y.apply(this,z);this.trigger.apply(this,["route:"+x].concat(z));b.history.trigger("route",this,x,z)},this));return this},navigate:function(x,w){b.history.navigate(x,w)},_bindRoutes:function(){if(!this.routes){return}var x=[];for(var y in this.routes){x.unshift([y,this.routes[y]])}for(var z=0,w=x.length;z<w;z++){this.route(x[z][0],x[z][1],this[x[z][1]])}},_routeToRegExp:function(w){w=w.replace(d,"\\$&").replace(g,"([^/]+)").replace(t,"(.*?)");return new RegExp("^"+w+"$")},_extractParameters:function(w,x){return w.exec(x).slice(1)}});b.History=function(){this.handlers=[];v.bindAll(this,"checkUrl")};var k=/^[#\/]/;var h=/msie [\w.]+/;var j=false;v.extend(b.History.prototype,b.Events,{interval:50,getFragment:function(x,w){if(x==null){if(this._hasPushState||w){x=window.location.pathname;var y=window.location.search;if(y){x+=y}}else{x=window.location.hash}}x=decodeURIComponent(x);if(!x.indexOf(this.options.root)){x=x.substr(this.options.root.length)}return x.replace(k,"")},start:function(y){if(j){throw new Error("Backbone.history has already been started")}this.options=v.extend({},{root:"/"},this.options,y);this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var x=this.getFragment();var w=document.documentMode;var A=(h.exec(navigator.userAgent.toLowerCase())&&(!w||w<=7));if(A){this.iframe=e('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(x)}if(this._hasPushState){e(window).bind("popstate",this.checkUrl)}else{if(this._wantsHashChange&&("onhashchange" in window)&&!A){e(window).bind("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=x;j=true;var B=window.location;var z=B.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!z){this.fragment=this.getFragment(null,true);window.location.replace(this.options.root+"#"+this.fragment);return true}else{if(this._wantsPushState&&this._hasPushState&&z&&B.hash){this.fragment=B.hash.replace(k,"");window.history.replaceState({},document.title,B.protocol+"//"+B.host+this.options.root+this.fragment)}}if(!this.options.silent){return this.loadUrl()}},stop:function(){e(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);j=false},route:function(w,x){this.handlers.unshift({route:w,callback:x})},checkUrl:function(x){var w=this.getFragment();if(w==this.fragment&&this.iframe){w=this.getFragment(this.iframe.location.hash)}if(w==this.fragment||w==decodeURIComponent(this.fragment)){return false}if(this.iframe){this.navigate(w)}this.loadUrl()||this.loadUrl(window.location.hash)},loadUrl:function(y){var x=this.fragment=this.getFragment(y);var w=v.any(this.handlers,function(z){if(z.route.test(x)){z.callback(x);return true}});return w},navigate:function(x,w){if(!j){return false}if(!w||w===true){w={trigger:w}}var y=(x||"").replace(k,"");if(this.fragment==y||this.fragment==decodeURIComponent(y)){return}if(this._hasPushState){if(y.indexOf(this.options.root)!=0){y=this.options.root+y}this.fragment=y;window.history[w.replace?"replaceState":"pushState"]({},document.title,y)}else{if(this._wantsHashChange){this.fragment=y;this._updateHash(window.location,y,w.replace);if(this.iframe&&(y!=this.getFragment(this.iframe.location.hash))){if(!w.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,y,w.replace)}}else{window.location.assign(this.options.root+x)}}if(w.trigger){this.loadUrl(x)}},_updateHash:function(w,x,y){if(y){w.replace(w.toString().replace(/(javascript:|#).*$/,"")+"#"+x)}else{w.hash=x}}});b.View=function(w){this.cid=v.uniqueId("view");this._configure(w||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var a=/^(\S+)\s*(.*)$/;var q=["model","collection","el","id","attributes","className","tagName"];v.extend(b.View.prototype,b.Events,{tagName:"div",$:function(w){return this.$el.find(w)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();return this},make:function(x,w,z){var y=document.createElement(x);if(w){e(y).attr(w)}if(z){e(y).html(z)}return y},setElement:function(w,x){this.$el=e(w);this.el=this.$el[0];if(x!==false){this.delegateEvents()}return this},delegateEvents:function(A){if(!(A||(A=c(this,"events")))){return}this.undelegateEvents();for(var z in A){var B=A[z];if(!v.isFunction(B)){B=this[A[z]]}if(!B){throw new Error('Event "'+A[z]+'" does not exist')}var y=z.match(a);var x=y[1],w=y[2];B=v.bind(B,this);x+=".delegateEvents"+this.cid;if(w===""){this.$el.bind(x,B)}else{this.$el.delegate(w,x,B)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(y){if(this.options){y=v.extend({},this.options,y)}for(var z=0,x=q.length;z<x;z++){var w=q[z];if(y[w]){this[w]=y[w]}}this.options=y},_ensureElement:function(){if(!this.el){var w=c(this,"attributes")||{};if(this.id){w.id=this.id}if(this.className){w["class"]=this.className}this.setElement(this.make(this.tagName,w),false)}else{this.setElement(this.el,false)}}});var r=function(w,x){var y=i(this,w,x);y.extend=this.extend;return y};b.Model.extend=b.Collection.extend=b.Router.extend=b.View.extend=r;var o={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};b.sync=function(A,x,w){var y=o[A];var z={type:y,dataType:"json"};if(!w.url){z.url=c(x,"url")||p()}if(!w.data&&x&&(A=="create"||A=="update")){z.contentType="application/json";z.data=JSON.stringify(x.toJSON())}if(b.emulateJSON){z.contentType="application/x-www-form-urlencoded";z.data=z.data?{model:z.data}:{}}if(b.emulateHTTP){if(y==="PUT"||y==="DELETE"){if(b.emulateJSON){z.data._method=y}z.type="POST";z.beforeSend=function(B){B.setRequestHeader("X-HTTP-Method-Override",y)}}}if(z.type!=="GET"&&!b.emulateJSON){z.processData=false}return e.ajax(v.extend(z,w))};b.wrapError=function(x,y,w){return function(z,A){A=z===y?A:z;if(x){x(y,A,w)}else{y.trigger("error",y,A,w)}}};var f=function(){};var i=function(x,w,y){var z;if(w&&w.hasOwnProperty("constructor")){z=w.constructor}else{z=function(){x.apply(this,arguments)}}v.extend(z,x);f.prototype=x.prototype;z.prototype=new f();if(w){v.extend(z.prototype,w)}if(y){v.extend(z,y)}z.prototype.constructor=z;z.__super__=x.prototype;return z};var c=function(w,x){if(!(w&&w[x])){return null}return v.isFunction(w[x])?w[x]():w[x]};var p=function(){throw new Error('A "url" property or function must be specified')}}).call(this);